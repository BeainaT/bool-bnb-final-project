<div class="container-braintree">
  <h1 class="title-braintree">Sponsorizza il tuo appartamento</h1>
  <hr>
  <form action="/checkout" id="hosted-fields-form" method="post">
  <fieldset id="sponsors">
    <legend>Scegli il tipo di sponsorizzazione</legend>
    Basic <input type="radio" name="sponsor" value="Basic"/>
    Medium <input type="radio" name="sponsor" value="Medium"/>
    Premium <input type="radio" name="sponsor" value="Premium"/>
  </fieldset>
  <div id="hide">
    <label for="card-number">Card Number</label>
    <div id="card-number"></div>

    <label for="cvv">CVV</label>
    <div id="cvv"></div>

    <label for="expiration-date">Expiration Date</label>
    <div id="expiration-date"></div>
  </div>
    <div id="checkout-message"></div>

    <input id="payment-button" type="submit" value="Pay" disabled />
  </form>
</div>

<script>
  var form = document.querySelector('#hosted-fields-form');
  var submit = document.querySelector('input[type="submit"]');
  let sponsor = document.querySelector('#sponsors')
  let hide = document.querySelector('#hide')

  braintree.client.create({
    // Insert your tokenization key here
    authorization: 'sandbox_tvhngr3b_6fym96n5hknpmryw'
  }, function (clientErr, clientInstance) {
    if (clientErr) {
      console.error(clientErr);
      return;
    }

    // Create a hostedFields component to initialize the form

    braintree.hostedFields.create({
      client: clientInstance,
      // Customize the Hosted Fields.
      // More information can be found at:
      // https://developers.braintreepayments.com/guides/hosted-fields/styling/javascript/v3
      styles: {
        'input': {
          'font-size': '14px'
        },
        'input.invalid': {
          'color': 'red'
        },
        'input.valid': {
          'color': 'green'
        }
      },
      // Configure which fields in your card form will be generated by Hosted Fields instead
      fields: {
        number: {
          container: '#card-number',
          placeholder: '4111 1111 1111 1111'
        },
        cvv: {
          container: '#cvv',
          placeholder: '123'
        },
        expirationDate: {
          container: '#expiration-date',
          placeholder: '10/2022'
        }
      }
    }, function (hostedFieldsErr, instance) {
      if (hostedFieldsErr) {
        console.error(hostedFieldsErr);
        return;
      }

      // Once the fields are initialized enable the submit button
      submit.removeAttribute('disabled');

      // Initialize the form submit event
      form.addEventListener('submit', function (event) {
        event.preventDefault();
        // When the user clicks on the 'Submit payment' button this code will send the
        // encrypted payment information in a variable called a payment method nonce
        instance.tokenize(function (tokenizeErr, payload) {
          if (tokenizeErr) {
            console.error(tokenizeErr);
            return;
          }

          $.ajax({
            type: 'POST',
            url: '/checkout',
            data: {'paymentMethodNonce': payload.nonce}
          }).done(function(result) {
            // Since the following code will overwrite the contents of
            // your page with a success or error message, first teardown
            // the Hosted Fields form to remove any extra event listeners
            // and iframes that the Braintree SDK added to your page
            instance.teardown(function (teardownErr) {
              if (teardownErr) {
                console.error('Could not tear down the Hosted Fields form!');
              } else {
                console.info('Hosted Fields form has been torn down!');
                // Remove the 'Submit payment' button
                form.removeChild(submit);
                form.removeChild(sponsors);
                form.removeChild(hide);
              }
            });

            if (result.success) {
              $('#checkout-message').html('<h1>Complimenti</h1><p>Il tuo appartamento Ã¨ stato sponsorizzato! Check your <a href="https://sandbox.braintreegateway.com/login">sandbox Control Panel</a> for your test transactions.</p><p>Refresh to try another transaction.</p>');
            } else {
              $('#checkout-message').html('<h1>Error</h1><p>Check your console.</p>');
            }
          });
        });
      }, false);
    });
  });
</script>

<style>
.container-braintree{
  width: 40%;
  margin: auto;
  background-color: #495867;
  border-radius: 0px 20px 20px 0;
  color: #788bff;
}
.title-braintree{
  padding: 10px 5px ;
}

form{
  margin: 5px;
}

#payment-button{
  width: 100px;
  border-radius: 20px;
  border: none;
  padding: 10px;
  margin-bottom: 5px;
  background-color: #FE5F55;
  cursor: pointer;
}
</style>